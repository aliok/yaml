#!/usr/bin/env bash

STRIMZI_CRT=$(kubectl -n kafka get secret my-cluster-cluster-ca-cert --template='{{index .data "ca.crt"}}' | base64 --decode )
TLSUSER_CRT=$(kubectl -n kafka get secret my-tls-user --template='{{index .data "user.crt"}}' | base64 --decode )
TLSUSER_KEY=$(kubectl -n kafka get secret my-tls-user --template='{{index .data "user.key"}}' | base64 --decode )

kubectl create secret --namespace knative-eventing generic strimzi-tls-secret \
  --from-literal=ca.crt="$STRIMZI_CRT" \
  --from-literal=user.crt="$TLSUSER_CRT" \
  --from-literal=user.key="$TLSUSER_KEY" \
  --from-literal=protocol="SSL" \
  --dry-run=client -o yaml | kubectl apply -n knative-eventing -f -

# ------------- WHAT IS CREATED? --------------------
#
#  apiVersion: v1
#  data:
#    ca.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURMVENDQWhXZ0F3SUJBZ0lKQUpKa1hkeGt1b04vTUEwR0NTcUdTSWIzRFFFQkN3VUFNQzB4RXpBUkJnTlYKQkFvTUNtbHZMbk4wY21sdGVta3hGakFVQmdOVkJBTU1EV05zZFhOMFpYSXRZMkVnZGpBd0hoY05Nakl3TVRJMgpNVEV6TkRJNVdoY05Nak13TVRJMk1URXpOREk1V2pBdE1STXdFUVlEVlFRS0RBcHBieTV6ZEhKcGJYcHBNUll3CkZBWURWUVFEREExamJIVnpkR1Z5TFdOaElIWXdNSUlCSWpBTkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUIKQ2dLQ0FRRUFvMWtiTWFnVWZvck5Ea2FVOHo3TTlwaEdwbkl1ZGc0RUVHdkhzN3FWY3VnOG5qUUUwemlpNk4vSgpNZjBTWWtxdTlFdmRmRUNHcFI0ZDRJY2dMWUtRWHU0YThmWWp5Q0YvcUtVcWZzclMrQktJbVRSV3VZV0JLV05vCnFDV2QyNk4zK3B2VTl6TUxmVllVd05hSVQ5cTIyS2NxK3pEUkFuWkdJbU02dmpDeDJXMlYwN21EVHNrUTFNOWUKSGFRQXd2ZlV5QmVQU2xsRmRBeWpFSFBWcW1DNks3blcyK1oybXJyYWRHaTJQalRQQjZTenNVWE4yMGRYdWRLSQowSGhybTgyYzUwQldZaGZ1M0t6NGR4OVpnekk2K0xsbko2T2hiRzB5RGs5cEJuOVpWVi9xaUFwU2VOUmhQYWZzCmtjR2FIbDQ2eXFwZWtoRHhOS3hEd2NINHdoZXNWUUlEQVFBQm8xQXdUakFkQmdOVkhRNEVGZ1FVaG9jV28xY28KRmVpUEFXbjNPMURMcFpKaDVLWXdId1lEVlIwakJCZ3dGb0FVaG9jV28xY29GZWlQQVduM08xRExwWkpoNUtZdwpEQVlEVlIwVEJBVXdBd0VCL3pBTkJna3Foa2lHOXcwQkFRc0ZBQU9DQVFFQWw3Qm4waE9kbzQxME40Zlp2Sm8xCnhPMnhabjdYWnJmZjhVLzRvQmZiUW1xemxCWS8xaCtSWlBmc1dWNjMwNnM3cU1ESGtQWHg0VjYrTVBkMFQ3T0kKbGx5UUZJU2wrVE93ZDNZU3NLNVdMNC9IQzRmUE9SbHl0Wi9kVVZzWFpCbGl2bXpWYWhrdnZLamlBL09lWWpLQwpRU0s4M2hCL04yNnYwa3dGYW1OaGxNaURRblk3cjc4YlhHczZDMi83dElCMlMyUUIySW53YUlwa0d0c3dSTkwxCjg1Qk9ndXhJTGEvQVY0WGNORG5ydG5yTGM3SVR3ZTlYUE11UzNSQWtVbnF0Y1BzeTdQM0NIZjhtM0FDck14Y0IKLzFHc3pDbmQ1aUhmQkZpUFFpOHdZOWFSNGc0THFONHNac1NvdzRNWEk1Slp1NmN1aEVURGN3azhScDN3bzBDRgowdz09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
#    protocol: U1NM
#    user.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUN2ekNDQWFjQ0NRQ2tKUkJrMmsyY01EQU5CZ2txaGtpRzl3MEJBUXNGQURBdE1STXdFUVlEVlFRS0RBcHAKYnk1emRISnBiWHBwTVJZd0ZBWURWUVFEREExamJHbGxiblJ6TFdOaElIWXdNQjRYRFRJeU1ERXlOakV4TXpZdwpORm9YRFRJek1ERXlOakV4TXpZd05Gb3dGakVVTUJJR0ExVUVBd3dMYlhrdGRHeHpMWFZ6WlhJd2dnRWlNQTBHCkNTcUdTSWIzRFFFQkFRVUFBNElCRHdBd2dnRUtBb0lCQVFDL0lTeCsyT0hCdys2NERIdnYyQy9jNHRkS292RjAKNCtnSTRVRDJ5QmhEM2FxRER6YWc4aFlkeHUrWWFKOG9LbFBVSHYzdUZ3MEFjeVRObkNGaDkxTHpoM0owYmQzaApqRjdnWnhXTEsvaFpBOHlZRmdaQ04yM2dNdUhUN2FDQlFtd2p1WGpHZzIrY0lXR0RIZExVUUpWVlpKb1RRQkVrCkZEcEhVRU1vczVjQVo2M0JIc2NDQURucm94UFRCNXZ6YkJxZ3U3cDZZUWhGUldycktYSWk1OGo1U1RhaEtCS3kKUUFzVUhocWdHVyt1Q1V1SDdjSnlRcmhBV1BkQ0pmYURHY3Z2V0RteG9MUGNhdGc5dklGZEMzdkNKM1pDdWg2QgpFckhwVXE3SHZ4OElEaW4wWDIyZ1RuOUFteFl6aE5pZU40WnFPSHB6SkpFWUVkVTFqV0o2ZmZXTkFnTUJBQUV3CkRRWUpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFJUDd1bXoxa3cwNUlSZnFkYVFveVltTUE0QW03Y04yeXI4ZTFiN3cKbWtTNWFKR2tyQW9UdGZjbW1qeXJjWjhsZ1ZjUFZyaDcvR1VKV1JjQjEyZ1hRdnorVFNic2lCK2FrRStDZ3c1NgpnYTF5bVRHcU9zZ3NFMmpZcWYzQWk5UktsK21CekhzUXZzdGdDSDdjWS9LVXNzR1duK0pVN2IyN3pMcjdCdnZCCm9GZmF5UGN5ZHd4NzBsNm9TcDdMWThPOHFYLzhpUkh4N291d2JzaE1BTUw1bFJsQUVJbUdZMTVHQm8zbXdBZGgKOVdld2pNR1ZJekUxUi9adkJYajhaN0diemd5YnEwYXNCbzlaeGQxcDM2WVdieGx4dS9Nb1JUMTRndlhaVjlHZApVVTdza0NnWmZOZDNHTlhRczBsMmYraXdYYmQvMkd4U1g5TEh5d3hUckgrcHNuQT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
#    user.key: LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV2QUlCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktZd2dnU2lBZ0VBQW9JQkFRQy9JU3grMk9IQncrNjQKREh2djJDL2M0dGRLb3ZGMDQrZ0k0VUQyeUJoRDNhcUREemFnOGhZZHh1K1lhSjhvS2xQVUh2M3VGdzBBY3lUTgpuQ0ZoOTFMemgzSjBiZDNoakY3Z1p4V0xLL2haQTh5WUZnWkNOMjNnTXVIVDdhQ0JRbXdqdVhqR2cyK2NJV0dECkhkTFVRSlZWWkpvVFFCRWtGRHBIVUVNb3M1Y0FaNjNCSHNjQ0FEbnJveFBUQjV2emJCcWd1N3A2WVFoRlJXcnIKS1hJaTU4ajVTVGFoS0JLeVFBc1VIaHFnR1crdUNVdUg3Y0p5UXJoQVdQZENKZmFER2N2dldEbXhvTFBjYXRnOQp2SUZkQzN2Q0ozWkN1aDZCRXJIcFVxN0h2eDhJRGluMFgyMmdUbjlBbXhZemhOaWVONFpxT0hwekpKRVlFZFUxCmpXSjZmZldOQWdNQkFBRUNnZ0VBV0tuSS9HY2NBMGtqT3BuLy9IbHJhcXFJZVFVeHdhbmdBQTZPbG15b1pRTTEKa0dyRVN0RkMxVGx0K0dQQVFWK3hWNXV3N0h3ZytlNXdTamw5ZXZiQ3NscEpEQjNUYWtnMTB4Kys3THJQRUd3awp3d0Nra3A4b0IzTlRNMzd1a0VnQjVtaXAwRjAwcjFjRTUxQTBkMlltWUdDMDRPMDlobUVqeitVNTRtMjlST0FGCk1GQ0VZSjFycGJ5aDZ6QTVtM2YzU1V1WGtTcHJCcEs3SFkzbTVhdjdEcnQ3cGUrZEZlTkFEUHRjQVhKcVkyWk0KTVdGeWQ2eExoMGwrR3JjQzZJeDFMNkVvZVZvbHhnSTlSN00vYm1GcHJhNjVXNnQ2N0hKTDRqNEZIVVNZSXI1VQpUa1MzdG5uMW5GS3ZrVzFEWWV3M0tybW05d1VmUHMxK1orRVMxOFp2dVFLQmdRRDRQL0Era0VXSEs2emZWVzZSCjA4ZFFucERmSVdrRnU5L0RKTk43ZHo1VFZWTE4rbnhEOW53TFJDWCtySjVNRHhYRmRVSHVhMzV6ZHdHZXN4T3kKQ0FaZElCemwvUkVFdWZGV0RnYmh2UGp1WGJYWXZWV2FKM1hBdTB3anAwL1hVcnFJN2ZRQjViRHVlL2tFbzNCcQpwdFFkZnpTaTMzbFdoK1RtVzNCN0hpTG13d0tCZ1FERkdMZ3p5cmdFc0RyYUVxT3hkVldVVy9rWjdCdlVQOUloCmY4TnhiWnpCV2dKWWlnT1RBSzBZbFdKaWFEUFJvL2JQcDJuMjRMdTRYcWxtZ0dCcHMveXFncFhoVVNURW13b0wKUVhqbTk0VktIc1RyUVh1Uk8rbC9uY3pSWkxHV2tEMG5mdEw1N0o2Q0ExUmh5dGtPNStHU3l5MjZiNjNObnBGLwpUWEhHdTR3TmJ3S0JnRlp4eFZHejRWSXBaa0E2dW83ekpQT3cwNWV2UmFmbWZRdXg5aWFISmwvVVZVbytrQ2tHCldybDltSkZ2UUl3UnNLNGFuOFBMRUxSYVcya015SzMwMTJwME5UdnMvSkVkd3FrSnAySFI4UWpuL3R1alNueXMKZ3ZlREFRZGxTb3NiVnJNNTBQOGNJWmxaK0NPaVdoSDVWK0dSbXgyZ0hkdUE1TGRHWGd1eE9jd0xBb0dBTE1TdQpvbVQ3WTJVOEdPaCs4Z0g2ekZZUHdNbVdrS0ZtYzJGMzNUM09pMFNNbjl2SmNBeUpSTG81dkt4NmlMVzdpL00wCjZIU25idnRoY3Z6WjZXaU9qWlJYd3ZRUmErN2pXeWNsOVNCbjBDd3BBbDYvV0gvSlM4bG1Dbkhhdko1S3BidnkKNC8zUkN5c0NjYXdIblpFaDladmM2U29ReWxHb0xzaENmYWQvNmxVQ2dZQVJRSUhacUlTVU1nNTJrb3hWSGM5Ugpvbk1NNUU3MEpWb1Nzb1FtellKeUxhd05EdHdyQjZXVnpLY1owUnNiOTArbEptamthNDVyNW5RVVBmamZvUTVQCkhkdFZlWjVEWjJCSVNRVWJEQ1VEL3c4TjhZZHZLZzVaK2kvYnlQNWpjTzdWN0VPSDJ4YmZPMGNQMXJnb2xEbFQKd3FKbVhGOGd1WU16aGtjN1J4VCtvZz09Ci0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS0K
#  kind: Secret
#  metadata:
#    name: strimzi-tls-secret
#    namespace: knative-eventing
#  type: Opaque

# -------------- HOW IT IS USED? -------------------
#
#  apiVersion: v1
#  data:
#    auth.secret.ref.name: strimzi-tls-secret
#    bootstrap.servers: my-cluster-kafka-bootstrap.kafka:9093
#    default.topic.partitions: "2"
#    default.topic.replication.factor: "2"
#  kind: ConfigMap
#  metadata:
#    name: config-broker
#    namespace: knative-eventing
